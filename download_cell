import os
import shutil

# 1. Define your source and destination
source_path = "./tmp/result_trt.mp4"
# DBFS FileStore is the special folder that allows browser downloads
target_dir = "/dbfs/FileStore/" 
target_path = os.path.join(target_dir, "result.mp4")

# 2. Check if the file exists and move it
if os.path.exists(source_path):
    # Ensure the directory exists
    os.makedirs(target_dir, exist_ok=True)
    
    # Copy from local driver -> DBFS
    print(f"Copying {source_path} to {target_path}...")
    shutil.copy(source_path, target_path)
    
    # 3. Generate the Download Button (Databricks specific)
    try:
        # This creates a clickable link in your notebook output
        displayHTML(f'''
            <div style="background-color: #e8f0fe; padding: 10px; border-radius: 5px; border: 1px solid #4285f4; text-align: center;">
                <h3 style="margin:0;">Processing Complete!</h3>
                <br>
                <a href="/files/result.mp4" download 
                   style="background-color: #4285f4; color: white; padding: 10px 20px; text-decoration: none; border-radius: 4px; font-weight: bold;">
                   Click Here to Download Result.mp4
                </a>
                <br><br>
                <small>File location: /dbfs/FileStore/result.mp4</small>
            </div>
        ''')
    except NameError:
        # Fallback if displayHTML is not available (rare in Databricks)
        print(f"File copied to DBFS. You can download it from: {target_path}")
        print("URL: <your-workspace-url>/files/NewAudioResult.mp4")

else:
    print(f"Error: Could not find '{source_path}'. Did the ffmpeg command finish successfully?")
