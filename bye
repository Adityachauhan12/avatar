# Create registry.py in basicsr/utils/
registry_code = '''
"""Registry system for architectures, models, datasets, etc."""

class Registry:
    """A registry to map strings to classes or functions."""
    
    def __init__(self, name):
        self._name = name
        self._obj_map = {}
    
    def _register_module(self, module_class, module_name=None, force=False):
        if module_name is None:
            module_name = module_class.__name__
        if not force and module_name in self._obj_map:
            raise KeyError(f'{module_name} is already registered in {self._name}')
        self._obj_map[module_name] = module_class
    
    def register(self, module_name=None, force=False):
        """Decorator to register a module."""
        def _register(cls):
            self._register_module(module_class=cls, module_name=module_name, force=force)
            return cls
        return _register
    
    def get(self, key):
        """Get the registered module."""
        return self._obj_map.get(key, None)
    
    def __contains__(self, key):
        return key in self._obj_map
    
    def __repr__(self):
        return f'Registry(name={self._name}, items={list(self._obj_map.keys())})'


# Create global registries (used by GFPGAN and other modules)
ARCH_REGISTRY = Registry('arch')
MODEL_REGISTRY = Registry('model')
DATASET_REGISTRY = Registry('dataset')
LOSS_REGISTRY = Registry('loss')
METRIC_REGISTRY = Registry('metric')
'''

with open('/dbfs/FileStore/VideoReTalking/basicsr/utils/registry.py', 'w') as f:
    f.write(registry_code)

# Update utils __init__.py to include registry
with open('/dbfs/FileStore/VideoReTalking/basicsr/utils/__init__.py', 'w') as f:
    f.write('from .misc import scandir\nfrom .registry import ARCH_REGISTRY, MODEL_REGISTRY, DATASET_REGISTRY, LOSS_REGISTRY, METRIC_REGISTRY\n')

print("âœ… BasicSR registry stub created")
