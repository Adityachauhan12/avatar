import subprocess
import os
import shutil

# 1. Clone Ditto repo
repo_dir = "/tmp/ditto-rebuild"
if os.path.exists(repo_dir):
    shutil.rmtree(repo_dir)

subprocess.run([
    "git", "clone", "--depth", "1",
    "https://github.com/antgroup/ditto-talkinghead.git",
    repo_dir
], check=True)

# 2. Install TensorRT 9.3.0
subprocess.run([
    "pip", "install", "-q",
    "--index-url", "https://pypi.nvidia.com",
    "tensorrt==9.3.0.post12.dev1",
    "tensorrt-libs==9.3.0.post12.dev1",
    "tensorrt-bindings==9.3.0.post12.dev1"
], check=True)

# 3. Install Ditto dependencies
os.chdir(repo_dir)
subprocess.run(["pip", "install", "-q", "-e", "."], check=True)

# 4. **RUN THIS IN THE DITTO REPO** to rebuild engines
# (This depends on Ditto's specific build scripts)
# You'll need to check ditto-talkinghead/scripts for the build process
print("âœ… Ready to rebuild engines")
print(f"ðŸ“‚ Repo: {repo_dir}")
print("ðŸ‘‰ Check ditto-talkinghead docs for engine rebuild script")
