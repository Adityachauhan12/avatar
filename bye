got this just now (<1s)
8
8
    print("Could not find exact line. Manual edit needed.")

# Write back
with open(tensorrt_utils_path, "w") as f:
    f.write(content)

print("✅ Saved to:", tensorrt_utils_path)
✅ Patched tensorrt_utils.py
✅ Saved to: /tmp/ditto-rebuild/core/utils/tensorrt_utils.py on running

import shutil

tensorrt_utils_path = "/tmp/ditto-rebuild/core/utils/tensorrt_utils.py"

# Backup original
shutil.copy(tensorrt_utils_path, tensorrt_utils_path + ".backup")

# Read current file
with open(tensorrt_utils_path, "r") as f:
    content = f.read()

# Replace the assert line with try-except
old_line = """            self.engine = runtime.deserialize_cuda_engine(f.read())
        assert self.engine"""

new_code = """            self.engine = runtime.deserialize_cuda_engine(f.read())
        except Exception as e:
            if "Version tag does not match" in str(e) or "Serialization" in str(e):
                print(f"⚠️ TensorRT engine format mismatch (expected 9.3.0, engine built with 9.6+)")
                self.engine = None
            else:
                raise
        
        assert self.engine, f"Failed to load engine. Rebuild with TensorRT 9.3.0."""

if old_line in content:
    content = content.replace(old_line, new_code)
    print("✅ Patched tensorrt_utils.py")
else:
    print("Could not find exact line. Manual edit needed.")

# Write back
with open(tensorrt_utils_path, "w") as f:
    f.write(content)

print("✅ Saved to:", tensorrt_utils_path)
