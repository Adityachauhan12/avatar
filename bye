code = r'''
import cv2
import numpy as np

from align_faces import warp_and_crop_face, get_reference_facial_points
from utils.inference_utils import Laplacian_Pyramid_Blending_with_mask

# Face detector (SFD)
from face_detection.api import FaceAlignment, LandmarksType


class FaceEnhancement(object):
    def __init__(self, base_dir='./', size=512, model=None,
                 use_sr=False, sr_model=None,
                 channel_multiplier=2, narrow=1, device='cuda'):

        self.facedetector = FaceAlignment(
            landmarks_type=LandmarksType._2D,
            device=device,
            face_detector='sfd'
        )

        self.size = size
        self.threshold = 0.9

        # Simple blending mask
        self.mask = np.zeros((512, 512), np.float32)
        cv2.rectangle(self.mask, (40, 40), (472, 472), (1, 1, 1), -1)
        self.mask = cv2.GaussianBlur(self.mask, (101, 101), 15)

        self.reference_5pts = get_reference_facial_points(
            (self.size, self.size), 0.25, (0, 0), True
        )

    def process(self, img, ori_img, bbox=None,
                face_enhance=False, possion_blending=False):

        detections = self.facedetector.get_detections_for_batch(
            np.expand_dims(img[..., ::-1], axis=0)
        )

        if detections[0] is None:
            return ori_img, [], []

        x1, y1, x2, y2 = detections[0]

        # Fake landmarks (not used)
        facial5points = np.zeros((2, 5))

        of, tfm_inv = warp_and_crop_face(
            img, facial5points,
            reference_pts=self.reference_5pts,
            crop_size=(self.size, self.size)
        )

        ef = of  # no enhancement

        h, w = img.shape[:2]
        tmp_mask = cv2.resize(self.mask, ef.shape[:2])
        tmp_mask = cv2.warpAffine(tmp_mask, tfm_inv, (w, h))
        tmp_img = cv2.warpAffine(ef, tfm_inv, (w, h))

        full_mask = tmp_mask[:, :, None]
        out = cv2.convertScaleAbs(
            ori_img * (1 - full_mask) + tmp_img * full_mask
        )

        return out, [], []
'''

path = "/dbfs/FileStore/VideoReTalking/third_part/GPEN/gpen_face_enhancer.py"

with open(path, "w") as f:
    f.write(code)

print("âœ… FaceEnhancement rewritten: NO GPEN, NO FaceParse, NO external models")
